(function(a){function b(b){function r(a,b){if(b.series.pie.show){b.grid.show=false;if(b.series.pie.label.show=="auto")if(b.legend.show)b.series.pie.label.show=false;else b.series.pie.label.show=true;if(b.series.pie.radius=="auto")if(b.series.pie.label.show)b.series.pie.radius=3/4;else b.series.pie.radius=1;if(b.series.pie.tilt>1)b.series.pie.tilt=1;if(b.series.pie.tilt<0)b.series.pie.tilt=0;a.hooks.processDatapoints.push(v);a.hooks.drawOverlay.push(L);a.hooks.draw.push(B)}}function s(a,b){var c=a.getOptions();if(c.series.pie.show&&c.grid.hoverable)b.unbind("mousemove").mousemove(F);if(c.series.pie.show&&c.grid.clickable)b.unbind("click").click(G)}function t(a){function c(a,d){if(!d)d=0;for(var e=0;e<a.length;++e){for(var f=0;f<d;f++)b+="	";if(typeof a[e]=="object"){b+=""+e+":\n";c(a[e],d+1)}else{b+=""+e+": "+a[e]+"\n"}}}var b="";c(a);alert(b)}function u(a){for(var b=0;b<a.length;++b){var c=parseFloat(a[b].data[0][1]);if(c)j+=c}}function v(b,f,g,h){if(!o){o=true;d=b.getCanvas();e=a(d).parent();c=b.getOptions();b.setData(A(b.getData()))}}function w(){n=e.children().filter(".legend").children().width();f=Math.min(d.width,d.height/c.series.pie.tilt)/2;h=d.height/2+c.series.pie.offset.top;g=d.width/2;if(c.series.pie.offset.left=="auto")if(c.legend.position.match("w"))g+=n/2;else g-=n/2;else g+=c.series.pie.offset.left;if(g<f)g=f;else if(g>d.width-f)g=d.width-f}function z(a){for(var b=0;b<a.length;++b){if(typeof a[b].data=="number")a[b].data=[[1,a[b].data]];else if(typeof a[b].data=="undefined"||typeof a[b].data[0]=="undefined"){if(typeof a[b].data!="undefined"&&typeof a[b].data.label!="undefined")a[b].label=a[b].data.label;a[b].data=[[1,0]]}}return a}function A(a){a=z(a);u(a);var b=0;var d=0;var e=c.series.pie.combine.color;var f=[];for(var g=0;g<a.length;++g){a[g].data[0][1]=parseFloat(a[g].data[0][1]);if(!a[g].data[0][1])a[g].data[0][1]=0;if(a[g].data[0][1]/j<=c.series.pie.combine.threshold){b+=a[g].data[0][1];d++;if(!e)e=a[g].color}else{f.push({data:[[1,a[g].data[0][1]]],color:a[g].color,label:a[g].label,angle:a[g].data[0][1]*Math.PI*2/j,percent:a[g].data[0][1]/j*100})}}if(d>0)f.push({data:[[1,b]],color:e,label:c.series.pie.combine.label,angle:b*Math.PI*2/j,percent:b/j*100});return f}function B(b,i){function q(){ctx.clearRect(0,0,d.width,d.height);e.children().filter(".pieLabel, .pieLabelBackground").remove();j=0;o=false}function r(){var a=5;var b=15;var e=10;var i=.02;if(c.series.pie.radius>1)var j=c.series.pie.radius;else var j=f*c.series.pie.radius;if(j>=d.width/2-a||j*c.series.pie.tilt>=d.height/2-b||j<=e)return;ctx.save();ctx.translate(a,b);ctx.globalAlpha=i;ctx.fillStyle="#000";ctx.translate(g,h);ctx.scale(1,c.series.pie.tilt);for(var k=1;k<=e;k++){ctx.beginPath();ctx.arc(0,0,j,0,Math.PI*2,false);ctx.fill();j-=k}ctx.restore()}function s(){function l(c,d,e){if(c<=0)return;if(e)ctx.fillStyle=d;else{ctx.strokeStyle=d;ctx.lineJoin="round"}ctx.beginPath();if(Math.abs(c-Math.PI*2)>1e-9)ctx.moveTo(0,0);else if(a.browser.msie)c-=1e-4;ctx.arc(0,0,b,i,i+c,false);ctx.closePath();i+=c;if(e)ctx.fill();else ctx.stroke()}function m(){function l(b,f,j){if(b.data[0][1]==0)return;var l=c.legend.labelFormatter,m,n=c.series.pie.label.formatter;if(l)m=l(b.label,b);else m=b.label;if(n)m=n(m,b);var o=(f+b.angle+f)/2;var p=g+Math.round(Math.cos(o)*i);var q=h+Math.round(Math.sin(o)*i)*c.series.pie.tilt;var r='<span class="pieLabel" id="pieLabel'+j+'" style="position:absolute;top:'+q+"px;left:"+p+'px;">'+m+"</span>";e.append(r);var s=e.children("#pieLabel"+j);var t=q-s.height()/2;var u=p-s.width()/2;s.css("top",t);s.css("left",u);if(0-t>0||0-u>0||d.height-(t+s.height())<0||d.width-(u+s.width())<0)k=true;if(c.series.pie.label.background.opacity!=0){var v=c.series.pie.label.background.color;if(v==null){v=b.color}var w="top:"+t+"px;left:"+u+"px;";a('<div class="pieLabelBackground" style="position:absolute;width:'+s.width()+"px;height:"+s.height()+"px;"+w+"background-color:"+v+';"> </div>').insertBefore(s).css("opacity",c.series.pie.label.background.opacity)}}var b=startAngle;if(c.series.pie.label.radius>1)var i=c.series.pie.label.radius;else var i=f*c.series.pie.label.radius;for(var j=0;j<n.length;++j){if(n[j].percent>=c.series.pie.label.threshold*100)l(n[j],b,j);b+=n[j].angle}}startAngle=Math.PI*c.series.pie.startAngle;if(c.series.pie.radius>1)var b=c.series.pie.radius;else var b=f*c.series.pie.radius;ctx.save();ctx.translate(g,h);ctx.scale(1,c.series.pie.tilt);ctx.save();var i=startAngle;for(var j=0;j<n.length;++j){n[j].startAngle=i;l(n[j].angle,n[j].color,true)}ctx.restore();ctx.save();ctx.lineWidth=c.series.pie.stroke.width;i=startAngle;for(var j=0;j<n.length;++j)l(n[j].angle,c.series.pie.stroke.color,false);ctx.restore();C(ctx);if(c.series.pie.label.show)m();ctx.restore()}if(!e)return;ctx=i;w();var n=b.getData();var p=0;k=true;while(k&&p<l){k=false;if(p>0)f*=m;p+=1;q();if(c.series.pie.tilt<=.8)r();s();b.triggerRedrawOverlay()}if(p>=l){q();e.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')}if(b.setSeries&&b.insertLegend){b.setSeries(n);b.insertLegend()}}function C(a){if(c.series.pie.innerRadius>0){a.save();innerRadius=c.series.pie.innerRadius>1?c.series.pie.innerRadius:f*c.series.pie.innerRadius;a.globalCompositeOperation="destination-out";a.beginPath();a.fillStyle=c.series.pie.stroke.color;a.arc(0,0,innerRadius,0,Math.PI*2,false);a.fill();a.closePath();a.restore();a.save();a.beginPath();a.strokeStyle=c.series.pie.stroke.color;a.arc(0,0,innerRadius,0,Math.PI*2,false);a.stroke();a.closePath();a.restore()}}function D(a,b){for(var c=false,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d][1]<=b[1]&&b[1]<a[f][1]||a[f][1]<=b[1]&&b[1]<a[d][1])&&b[0]<(a[f][0]-a[d][0])*(b[1]-a[d][1])/(a[f][1]-a[d][1])+a[d][0]&&(c=!c);return c}function E(a,c){var d=b.getData(),e=b.getOptions(),i=e.series.pie.radius>1?e.series.pie.radius:f*e.series.pie.radius;for(var j=0;j<d.length;++j){var k=d[j];if(k.pie.show){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,i,k.startAngle,k.startAngle+k.angle,false);ctx.closePath();x=a-g;y=c-h;if(ctx.isPointInPath){if(ctx.isPointInPath(a-g,c-h)){ctx.restore();return{datapoint:[k.percent,k.data],dataIndex:0,series:k,seriesIndex:j}}}else{p1X=i*Math.cos(k.startAngle);p1Y=i*Math.sin(k.startAngle);p2X=i*Math.cos(k.startAngle+k.angle/4);p2Y=i*Math.sin(k.startAngle+k.angle/4);p3X=i*Math.cos(k.startAngle+k.angle/2);p3Y=i*Math.sin(k.startAngle+k.angle/2);p4X=i*Math.cos(k.startAngle+k.angle/1.5);p4Y=i*Math.sin(k.startAngle+k.angle/1.5);p5X=i*Math.cos(k.startAngle+k.angle);p5Y=i*Math.sin(k.startAngle+k.angle);arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];if(D(arrPoly,arrPoint)){ctx.restore();return{datapoint:[k.percent,k.data],dataIndex:0,series:k,seriesIndex:j}}}ctx.restore()}}return null}function F(a){H("plothover",a)}function G(a){H("plotclick",a)}function H(a,d){var f=b.offset(),g=parseInt(d.pageX-f.left),h=parseInt(d.pageY-f.top),i=E(g,h);if(c.grid.autoHighlight){for(var j=0;j<q.length;++j){var k=q[j];if(k.auto==a&&!(i&&k.series==i.series))J(k.series)}}if(i)I(i.series,a);var l={pageX:d.pageX,pageY:d.pageY};e.trigger(a,[l,i])}function I(a,c){if(typeof a=="number")a=series[a];var d=K(a);if(d==-1){q.push({series:a,auto:c});b.triggerRedrawOverlay()}else if(!c)q[d].auto=false}function J(a){if(a==null){q=[];b.triggerRedrawOverlay()}if(typeof a=="number")a=series[a];var c=K(a);if(c!=-1){q.splice(c,1);b.triggerRedrawOverlay()}}function K(a){for(var b=0;b<q.length;++b){var c=q[b];if(c.series==a)return b}return-1}function L(a,b){function e(a){if(a.angle<0)return;b.fillStyle="rgba(255, 255, 255, "+c.series.pie.highlight.opacity+")";b.beginPath();if(Math.abs(a.angle-Math.PI*2)>1e-9)b.moveTo(0,0);b.arc(0,0,d,a.startAngle,a.startAngle+a.angle,false);b.closePath();b.fill()}var c=a.getOptions();var d=c.series.pie.radius>1?c.series.pie.radius:f*c.series.pie.radius;b.save();b.translate(g,h);b.scale(1,c.series.pie.tilt);for(i=0;i<q.length;++i)e(q[i].series);C(b);b.restore()}var d=null;var e=null;var f=null;var g=null;var h=null;var j=0;var k=true;var l=10;var m=.95;var n=0;var o=false;var p=false;var q=[];b.hooks.processOptions.push(r);b.hooks.bindEvents.push(s)}var c={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(a,b){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+b.color+';">'+a+"<br/>"+Math.round(b.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};a.plot.plugins.push({init:b,options:c,name:"pie",version:"1.0"})})(jQuery)