!function(e){e.Jcrop=function(t,n){function i(e){return Math.round(e)+"px"}function o(e){return O.baseClass+"-"+e}function r(){return e.fx.step.hasOwnProperty("backgroundColor")}function a(t){var n=e(t).offset();return[n.left,n.top]}function s(e){return[e.pageX-z[0],e.pageY-z[1]]}function l(t){"object"!=typeof t&&(t={}),O=e.extend(O,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof O[t]&&(O[t]=function(){})})}function c(e,t,n){if(z=a(q),ft.setCursor("move"===e?e:e+"-resize"),"move"===e)return ft.activateHandlers(p(t),m,n);var i=pt.getFixed(),o=d(e),r=pt.getCorner(d(o));pt.setPressed(pt.getCorner(o)),pt.setCurrent(r),ft.activateHandlers(u(e,i),m,n)}function u(e,t){return function(n){if(O.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}pt.setCurrent(n),ht.update()}}function p(e){var t=e;return gt.watchKeys(),function(e){pt.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,ht.update()}}function d(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function h(e){return function(t){return O.disabled?!1:"move"!==e||O.allowMove?(z=a(q),it=!0,c(e,s(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}function f(e,t,n){var i=e.width(),o=e.height();i>t&&t>0&&(i=t,o=t/e.width()*e.height()),o>n&&n>0&&(o=n,i=n/e.height()*e.width()),tt=e.width()/i,nt=e.height()/o,e.width(i).height(o)}function g(e){return{x:e.x*tt,y:e.y*nt,x2:e.x2*tt,y2:e.y2*nt,w:e.w*tt,h:e.h*nt}}function m(){var e=pt.getFixed();e.w>O.minSelect[0]&&e.h>O.minSelect[1]?(ht.enableHandles(),ht.done()):ht.release(),ft.setCursor(O.allowSelect?"crosshair":"default")}function v(e){if(O.disabled)return!1;if(!O.allowSelect)return!1;it=!0,z=a(q),ht.disableHandles(),ft.setCursor("crosshair");var t=s(e);return pt.setPressed(t),ht.update(),ft.activateHandlers(b,m,"touch"===e.type.substring(0,5)),gt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function b(e){pt.setCurrent(e),ht.update()}function y(){var t=e("<div></div>").addClass(o("tracker"));return P&&t.css({opacity:0,backgroundColor:"white"}),t}function x(e){$.removeClass().addClass(o("holder")).addClass(e)}function k(e,t){function n(){window.setTimeout(b,p)}var i=e[0]/tt,o=e[1]/nt,r=e[2]/tt,a=e[3]/nt;if(!ot){var s=pt.flipCoords(i,o,r,a),l=pt.getFixed(),c=[l.x,l.y,l.x2,l.y2],u=c,p=O.animationDelay,d=s[0]-c[0],h=s[1]-c[1],f=s[2]-c[2],g=s[3]-c[3],m=0,v=O.swingSpeed;i=u[0],o=u[1],r=u[2],a=u[3],ht.animMode(!0);var b=function(){return function(){m+=(100-m)/v,u[0]=Math.round(i+m/100*d),u[1]=Math.round(o+m/100*h),u[2]=Math.round(r+m/100*f),u[3]=Math.round(a+m/100*g),m>=99.8&&(m=100),100>m?(C(u),n()):(ht.done(),ht.animMode(!1),"function"==typeof t&&t.call(mt))}}();n()}}function w(e){C([e[0]/tt,e[1]/nt,e[2]/tt,e[3]/nt]),O.onSelect.call(mt,g(pt.getFixed())),ht.enableHandles()}function C(e){pt.setPressed([e[0],e[1]]),pt.setCurrent([e[2],e[3]]),ht.update()}function _(){return g(pt.getFixed())}function S(){return pt.getFixed()}function T(e){l(e),I()}function F(){O.disabled=!0,ht.disableHandles(),ht.setCursor("default"),ft.setCursor("default")}function M(){O.disabled=!1,I()}function A(){ht.done(),ft.activateHandlers(null,null)}function E(){$.remove(),H.show(),H.css("visibility","visible"),e(t).removeData("Jcrop")}function D(e,t){ht.release(),F();var n=new Image;n.onload=function(){var i=n.width,o=n.height,r=O.boxWidth,a=O.boxHeight;q.width(i).height(o),q.attr("src",e),Y.attr("src",e),f(q,r,a),X=q.width(),G=q.height(),Y.width(X).height(G),st.width(X+2*at).height(G+2*at),$.width(X).height(G),dt.resize(X,G),M(),"function"==typeof t&&t.call(mt)},n.src=e}function L(e,t,n){var i=t||O.bgColor;O.bgFade&&r()&&O.fadeTime&&!n?e.animate({backgroundColor:i},{queue:!1,duration:O.fadeTime}):e.css("backgroundColor",i)}function I(e){O.allowResize?e?ht.enableOnly():ht.enableHandles():ht.disableHandles(),ft.setCursor(O.allowSelect?"crosshair":"default"),ht.setCursor(O.allowMove?"move":"default"),O.hasOwnProperty("trueSize")&&(tt=O.trueSize[0]/X,nt=O.trueSize[1]/G),O.hasOwnProperty("setSelect")&&(w(O.setSelect),ht.done(),delete O.setSelect),dt.refresh(),O.bgColor!=lt&&(L(O.shade?dt.getShades():$,O.shade?O.shadeColor||O.bgColor:O.bgColor),lt=O.bgColor),ct!=O.bgOpacity&&(ct=O.bgOpacity,O.shade?dt.refresh():ht.setBgOpacity(ct)),Q=O.maxSize[0]||0,K=O.maxSize[1]||0,Z=O.minSize[0]||0,et=O.minSize[1]||0,O.hasOwnProperty("outerImage")&&(q.attr("src",O.outerImage),delete O.outerImage),ht.refresh()}var z,O=e.extend({},e.Jcrop.defaults),N=navigator.userAgent.toLowerCase(),P=/msie/.test(N),j=/msie [1-6]\./.test(N);"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),l(n);var R={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},H=e(t),B=!0;if("IMG"==t.tagName){if(0!=H[0].width&&0!=H[0].height)H.width(H[0].width),H.height(H[0].height);else{var W=new Image;W.src=H[0].src,H.width(W.width),H.height(W.height)}var q=H.clone().removeAttr("id").css(R).show();q.width(H.width()),q.height(H.height()),H.after(q).hide()}else q=H.css(R).show(),B=!1,null===O.shade&&(O.shade=!0);f(q,O.boxWidth,O.boxHeight);var X=q.width(),G=q.height(),$=e("<div />").width(X).height(G).addClass(o("holder")).css({position:"relative",backgroundColor:O.bgColor}).insertAfter(H).append(q);O.addClass&&$.addClass(O.addClass);var Y=e("<div />"),V=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),U=e("<div />").width("100%").height("100%").css("zIndex",320),J=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=pt.getFixed();O.onDblClick.call(mt,e)}).insertBefore(q).append(V,U);B&&(Y=e("<img />").attr("src",q.attr("src")).css(R).width(X).height(G),V.append(Y)),j&&J.css({overflowY:"hidden"});var Q,K,Z,et,tt,nt,it,ot,rt,at=O.boundary,st=y().width(X+2*at).height(G+2*at).css({position:"absolute",top:i(-at),left:i(-at),zIndex:290}).mousedown(v),lt=O.bgColor,ct=O.bgOpacity;z=a(q);var ut=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],i=document.createElement("div");try{for(e=0;e<n.length;e++){var o=n[e];o="on"+o;var r=o in i;r||(i.setAttribute(o,"return;"),r="function"==typeof i[o]),t[n[e]]=r}return t.touchstart&&t.touchend&&t.touchmove}catch(a){return!1}}function t(){return O.touchSupport===!0||O.touchSupport===!1?O.touchSupport:e()}return{createDragger:function(e){return function(t){return O.disabled?!1:"move"!==e||O.allowMove?(z=a(q),it=!0,c(e,s(ut.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:function(e){return v(ut.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),pt=function(){function e(e){e=a(e),f=d=e[0],g=h=e[1]}function t(e){e=a(e),u=e[0]-f,p=e[1]-g,f=e[0],g=e[1]}function n(){return[u,p]}function i(e){var t=e[0],n=e[1];0>d+t&&(t-=t+d),0>h+n&&(n-=n+h),g+n>G&&(n+=G-(g+n)),f+t>X&&(t+=X-(f+t)),d+=t,f+=t,h+=n,g+=n}function o(e){var t=r();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function r(){if(!O.aspectRatio)return l();var e,t,n,i,o=O.aspectRatio,r=O.minSize[0]/tt,a=O.maxSize[0]/tt,u=O.maxSize[1]/nt,p=f-d,m=g-h,v=Math.abs(p),b=Math.abs(m),y=v/b;return 0===a&&(a=10*X),0===u&&(u=10*G),o>y?(t=g,n=b*o,e=0>p?d-n:n+d,0>e?(e=0,i=Math.abs((e-d)/o),t=0>m?h-i:i+h):e>X&&(e=X,i=Math.abs((e-d)/o),t=0>m?h-i:i+h)):(e=f,i=v/o,t=0>m?h-i:h+i,0>t?(t=0,n=Math.abs((t-h)*o),e=0>p?d-n:n+d):t>G&&(t=G,n=Math.abs(t-h)*o,e=0>p?d-n:n+d)),e>d?(r>e-d?e=d+r:e-d>a&&(e=d+a),t=t>h?h+(e-d)/o:h-(e-d)/o):d>e&&(r>d-e?e=d-r:d-e>a&&(e=d-a),t=t>h?h+(d-e)/o:h-(d-e)/o),0>e?(d-=e,e=0):e>X&&(d-=e-X,e=X),0>t?(h-=t,t=0):t>G&&(h-=t-G,t=G),c(s(d,h,e,t))}function a(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>X&&(e[0]=X),e[1]>G&&(e[1]=G),[Math.round(e[0]),Math.round(e[1])]}function s(e,t,n,i){var o=e,r=n,a=t,s=i;return e>n&&(o=n,r=e),t>i&&(a=i,s=t),[o,a,r,s]}function l(){var e,t=f-d,n=g-h;return Q&&Math.abs(t)>Q&&(f=t>0?d+Q:d-Q),K&&Math.abs(n)>K&&(g=n>0?h+K:h-K),et/nt&&Math.abs(n)<et/nt&&(g=n>0?h+et/nt:h-et/nt),Z/tt&&Math.abs(t)<Z/tt&&(f=t>0?d+Z/tt:d-Z/tt),0>d&&(f-=d,d-=d),0>h&&(g-=h,h-=h),0>f&&(d-=f,f-=f),0>g&&(h-=g,g-=g),f>X&&(e=f-X,d-=e,f-=e),g>G&&(e=g-G,h-=e,g-=e),d>X&&(e=d-G,g-=e,h-=e),h>G&&(e=h-G,g-=e,h-=e),c(s(d,h,f,g))}function c(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var u,p,d=0,h=0,f=0,g=0;return{flipCoords:s,setPressed:e,setCurrent:t,getOffset:n,moveOffset:i,getCorner:o,getFixed:r}}(),dt=function(){function t(e,t){f.left.css({height:i(t)}),f.right.css({height:i(t)})}function n(){return o(pt.getFixed())}function o(e){f.top.css({left:i(e.x),width:i(e.w),height:i(e.y)}),f.bottom.css({top:i(e.y2),left:i(e.x),width:i(e.w),height:i(G-e.y2)}),f.right.css({left:i(e.x2),width:i(X-e.x2)}),f.left.css({width:i(e.x)})}function r(){return e("<div />").css({position:"absolute",backgroundColor:O.shadeColor||O.bgColor}).appendTo(h)}function a(){d||(d=!0,h.insertBefore(q),n(),ht.setBgOpacity(1,0,1),Y.hide(),s(O.shadeColor||O.bgColor,1),ht.isAwake()?c(O.bgOpacity,1):c(1,1))}function s(e,t){L(p(),e,t)}function l(){d&&(h.remove(),Y.show(),d=!1,ht.isAwake()?ht.setBgOpacity(O.bgOpacity,1,1):(ht.setBgOpacity(1,1,1),ht.disableHandles()),L($,0,1))}function c(e,t){d&&(O.bgFade&&!t?h.animate({opacity:1-e},{queue:!1,duration:O.fadeTime}):h.css({opacity:1-e}))}function u(){O.shade?a():l(),ht.isAwake()&&c(O.bgOpacity)}function p(){return h.children()}var d=!1,h=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:r(),left:r().height(G),right:r().height(G),bottom:r()};return{update:n,updateRaw:o,getShades:p,setBgColor:s,enable:a,disable:l,resize:t,refresh:u,opacity:c}}(),ht=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:O.borderOpacity}).addClass(o(t));return V.append(n),n}function n(t,n){var i=e("<div />").mousedown(h(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return ut.support&&i.bind("touchstart.jcrop",ut.createDragger(t)),U.append(i),i}function r(e){var t=O.handleSize,i=n(e,F++).css({opacity:O.handleOpacity}).addClass(o("handle"));return t&&i.width(t).height(t),i}function a(e){return n(e,F++).addClass("jcrop-dragbar")}function s(e){var t;for(t=0;t<e.length;t++)E[e[t]]=a(e[t])}function l(e){var n,i;for(i=0;i<e.length;i++){switch(e[i]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}M[e[i]]=t(n)}}function c(e){var t;for(t=0;t<e.length;t++)A[e[t]]=r(e[t])}function u(e,t){O.shade||Y.css({top:i(-t),left:i(-e)}),J.css({top:i(t),left:i(e)})}function p(e,t){J.width(Math.round(e)).height(Math.round(t))}function d(){var e=pt.getFixed();pt.setPressed([e.x,e.y]),pt.setCurrent([e.x2,e.y2]),f()}function f(e){return T?m(e):void 0}function m(e){var t=pt.getFixed();p(t.w,t.h),u(t.x,t.y),O.shade&&dt.updateRaw(t),T||b(),e?O.onSelect.call(mt,g(t)):O.onChange.call(mt,g(t))}function v(e,t,n){(T||t)&&(O.bgFade&&!n?q.animate({opacity:e},{queue:!1,duration:O.fadeTime}):q.css("opacity",e))}function b(){J.show(),O.shade?dt.opacity(ct):v(ct,!0),T=!0}function x(){C(),J.hide(),O.shade?dt.opacity(1):v(1),T=!1,O.onRelease.call(mt)}function k(){D&&U.show()}function w(){return D=!0,O.allowResize?(U.show(),!0):void 0}function C(){D=!1,U.hide()}function _(e){e?(ot=!0,C()):(ot=!1,w())}function S(){_(!1),d()}var T,F=370,M={},A={},E={},D=!1;O.dragEdges&&e.isArray(O.createDragbars)&&s(O.createDragbars),e.isArray(O.createHandles)&&c(O.createHandles),O.drawBorders&&e.isArray(O.createBorders)&&l(O.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var L=y().mousedown(h("move")).css({cursor:"move",position:"absolute",zIndex:360});return ut.support&&L.bind("touchstart.jcrop",ut.createDragger("move")),V.append(L),C(),{updateVisible:f,update:m,release:x,refresh:d,isAwake:function(){return T},setCursor:function(e){L.css("cursor",e)},enableHandles:w,enableOnly:function(){D=!0},showHandles:k,disableHandles:C,animMode:_,setBgOpacity:v,done:S}}(),ft=function(){function t(t){st.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",a).bind("touchend.jcrop",l):d&&e(document).bind("mousemove.jcrop",i).bind("mouseup.jcrop",o)}function n(){st.css({zIndex:290}),e(document).unbind(".jcrop")}function i(e){return u(s(e)),!1}function o(e){return e.preventDefault(),e.stopPropagation(),it&&(it=!1,p(s(e)),ht.isAwake()&&O.onSelect.call(mt,g(pt.getFixed())),n(),u=function(){},p=function(){}),!1}function r(e,n,i){return it=!0,u=e,p=n,t(i),!1}function a(e){return u(s(ut.cfilter(e))),!1}function l(e){return o(ut.cfilter(e))}function c(e){st.css("cursor",e)}var u=function(){},p=function(){},d=O.trackDocument;return d||st.mousemove(i).mouseup(o).mouseout(o),q.before(st),{activateHandlers:r,setCursor:c}}(),gt=function(){function t(){O.keySupport&&(r.show(),r.focus())}function n(){r.hide()}function i(e,t,n){O.allowMove&&(pt.moveOffset([t,n]),ht.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function o(e){if(e.ctrlKey||e.metaKey)return!0;rt=e.shiftKey?!0:!1;var t=rt?10:1;switch(e.keyCode){case 37:i(e,-t,0);break;case 39:i(e,t,0);break;case 38:i(e,0,-t);break;case 40:i(e,0,t);break;case 27:O.allowSelect&&ht.release();break;case 9:return!0}return!1}var r=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),a=e("<div />").css({position:"absolute",overflow:"hidden"}).append(r);return O.keySupport&&(r.keydown(o).blur(n),j||!O.fixedSupport?(r.css({position:"absolute",left:"-20px"}),a.append(r).insertBefore(q)):r.insertBefore(q)),{watchKeys:t}}();ut.support&&st.bind("touchstart.jcrop",ut.newSelection),U.hide(),I(!0);var mt={setImage:D,animateTo:k,setSelect:w,setOptions:T,tellSelect:_,tellScaled:S,setClass:x,disable:F,enable:M,cancel:A,release:ht.release,destroy:E,focus:gt.watchKeys,getBounds:function(){return[X*tt,G*nt]},getWidgetSize:function(){return[X,G]},getScaleFactor:function(){return[tt,nt]},getOptions:function(){return O},ui:{holder:$,selection:J}};return P&&$.bind("selectstart",function(){return!1}),H.data("Jcrop",mt),mt},e.fn.Jcrop=function(t,n){var i;return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),i=e.Jcrop(this,t),e.isFunction(n)&&n.call(i)}):(e(this).css({display:"block",visibility:"hidden"}),i=e.Jcrop(this,t),e.isFunction(n)&&n.call(i))}),this},e.Jcrop.Loader=function(t,n,i){function o(){a.complete?(r.unbind(".jcloader"),e.isFunction(n)&&n.call(a)):window.setTimeout(o,50)}var r=e(t),a=r[0];r.bind("load.jcloader",o).bind("error.jcloader",function(){r.unbind(".jcloader"),e.isFunction(i)&&i.call(a)}),a.complete&&e.isFunction(n)&&(r.unbind(".jcloader"),n.call(a))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);