(function(e){var t=[];var i={init:function(i){return this.each(function(){var s=this;var c=e(s).data("cbrepeat");if(c){return}c={};c.options=typeof i!="undefined"?i:{};c.defaults=e.fn.cbrepeat.defaults;c.settings=e.extend(true,{},c.defaults,c.options);c.element=e(s);if(c.settings.useData){e.each(c.defaults,function(e,t){if(e!="init"&&e!="useData"){var i=c.element.data("cbrepeat"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof i!="undefined"){c.settings[e]=i}else{i=c.element.data("cbrepeat"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof i!="undefined"){c.settings[e]=i}}}})}if(!c.settings.min){c.settings.min=1}c.element.triggerHandler("cbrepeat.init.before",[c]);if(!c.settings.init){return}if(c.settings.sortable){c.element.sortable({placeholder:c.element.children(".cbRepeatRow").first().attr("class")+" cbRepeatRowPlaceholder",forcePlaceholderSize:true,cursor:"move",items:".cbRepeatRow",containment:"parent",animated:true,stop:function(t,i){var r=[];c.element.children(".cbRepeatRow").find("input:checked").each(function(){r.push(e(this))});n.call(s,c);e.each(r,function(e,t){t.prop("checked",true)});c.element.triggerHandler("cbrepeat.move",[c,t,i])},tolerance:"pointer",handle:".cbRepeatRowMove",opacity:.5})}c.addHandler=function(t){t.preventDefault();var i=c.element.find(".cbRepeatRowAddCount").filter(function(){return e(this).closest(".cbRepeat").is(c.element)});var a=1;if(i.length&&i.val()>0){a=i.val()}if(c.settings.limit&&a>c.settings.limit){a=c.settings.limit;if(i.length){i.val(a)}}for(var n=0;n<a;++n){r.call(s)}};if(c.settings.add){c.element.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeat").is(c.element)}).on("click",c.addHandler)}c.removeHandler=function(t){t.preventDefault();var i=e(this).closest(".cbRepeatRow");a.call(s,i)};if(c.settings.remove){c.element.find(".cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeat").is(c.element)}).on("click",c.removeHandler)}n.call(s,c);c.element.on("remove destroy.cbrepeat",function(){c.element.cbrepeat("destroy")});c.element.on("rebind.cbrepeat",function(){c.element.cbrepeat("rebind")});c.element.on("modified.cbrepeat",function(e,t,i,r){if(i!=r){c.element.cbrepeat("rebind")}});c.element.bind("cloned.cbrepeat",function(){e(this).off("destroy.cbrepeat");e(this).off("rebind.cbrepeat");e(this).off("cloned.cbrepeat");e(this).off("modified.cbrepeat");e(this).removeData("cbrepeat");e(this).removeData("uiSortable");var t=e(this).find(".cbRepeatRow").first().parent();e(this).find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeat").is(t)}).off("click",c.addHandler);e(this).find(".cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeat").is(t)}).off("click",c.removeHandler);e(this).cbrepeat(c.options)});c.element.triggerHandler("cbrepeat.init.after",[c]);c.element.data("cbrepeat",c);t.push(c)})},add:function(){r.call(this);return this},remove:function(e){a.call(this,e);return this},update:function(){var t=e(this).data("cbrepeat");if(!t){return this}n.call(this,t);return this},reset:function(){var t=e(this).data("cbrepeat");if(!t){return this}var i=t.element.children(".cbRepeatRow:not(:first)");i.find('.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");i.remove();n.call(this,t);return this},rebind:function(){var t=e(this).data("cbrepeat");if(!t){return this}t.element.cbrepeat("cbrepeat");t.element.cbrepeat(t.options);return this},destroy:function(){var i=e(this).data("cbrepeat");if(!i){return this}if(i.settings.sortable){i.element.sortable("destroy");i.element.removeData("uiSortable")}i.element.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeat").is(i.element)}).off("click",i.addHandler);i.element.find(".cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeat").is(i.element)}).off("click",i.removeHandler);i.element.off("destroy.cbrepeat");i.element.off("rebind.cbrepeat");i.element.off("cloned.cbrepeat");i.element.off("modified.cbrepeat");e.each(t,function(e,r){if(r.element==i.element){t.splice(e,1);return false}return true});i.element.removeData("cbrepeat");i.element.triggerHandler("cbrepeat.destroyed",[i]);return this},instances:function(){return t}};function r(t){var i=e(this).data("cbrepeat");if(!i){return false}if(i.settings.max&&i.element.children(".cbRepeatRow").length>=i.settings.max){return false}var r=i.element.children(".cbRepeatRow").last();var a=[];r.find("input:checked").each(function(){a.push(e(this))});var s=r.clone(true);s.insertAfter(r);var c=s.find("*");if(i.settings.ignore){c=c.not(i.settings.ignore)}c.each(function(){if(e(this).is("input,select,textarea")){var t=e(this).attr("type");if(t=="checkbox"||t=="radio"){if(t=="radio"&&e(this).siblings('input[type="radio"]').length+1==2&&e(this).val()==0){e(this).prop("checked",true)}else{e(this).prop("checked",false);if(t=="radio"){e(this).next("label").removeClass("active")}}}else{e(this).val("");if(e(this).is("select")){if(!e(this).children('option[value=""]:first').length){e(this).val(e(this).children('option[value!=""]:first').val())}}}}e(this).triggerHandler("cloned");if(e(this).is("input,select,textarea")){e(this).trigger("change")}});n.call(this,i);e.each(a,function(e,t){t.prop("checked",true)});i.element.triggerHandler("cbrepeat.add",[i]);return true}function a(t){var i=e(this).data("cbrepeat");if(!i){return false}if(i.settings.min&&i.element.children(".cbRepeatRow").length<=i.settings.min){return false}if(!t){t=i.element.children(".cbRepeatRow").last()}t.find('.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");t.find(".cbRepeat").off("remove");t.remove();n.call(this,i);i.element.triggerHandler("cbrepeat.remove",[i]);return true}function n(t){var i=t.element.children(".cbRepeatRow");if(i.length>t.settings.min){i.find(".cbRepeatRowMove,.cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeatRow").is(i)}).removeClass("hidden");if(t.settings.sortable){t.element.sortable("enable")}}else{i.find(".cbRepeatRowMove,.cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeatRow").is(i)}).addClass("hidden");if(t.settings.sortable){t.element.sortable("disable")}}if(t.settings.max){if(i.length>=t.settings.max){i.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeatRow").is(i)}).addClass("hidden")}else{i.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeatRow").is(i)}).removeClass("hidden")}}if(!t.settings.sortable){i.find(".cbRepeatRowMove").filter(function(){return e(this).closest(".cbRepeatRow").is(i)}).addClass("hidden")}i.each(function(r){var a=e(this).find("*").filter(function(){return e(this).closest(".cbRepeatRow").is(i)});if(t.settings.ignore){a=a.not(t.settings.ignore)}a.each(function(){if(e(this).attr("id")){var i=e(this).attr("id");if(!e(this).data("orgId")){e(this).data("orgId",e(this).attr("id"))}e(this).attr("id",e(this).attr("id").replace(/^(.*__)(\d+)(__\w+)$/g,"$1"+r+"$3"));var a=e(this).attr("id");e(this).triggerHandler("modified",[i,a,r]);var n=i.replace("cbfr_","").replace("cbfv_","").replace(/__[a-zA-Z0-9]+$/g,"");var s=a.replace("cbfr_","").replace("cbfv_","").replace(/__[a-zA-Z0-9]+$/g,"");var c=e(this).closest(".cbRepeatRow").find("*[id]");if(t.settings.ignore){c=c.not(t.settings.ignore)}c.each(function(){var t=e(this).attr("id");if(!e(this).data("orgId")){e(this).data("orgId",e(this).attr("id"))}e(this).attr("id",e(this).attr("id").replace(n,s).replace(n.replace(/_{2,}/g,"__"),s.replace(/_{2,}/g,"__")));var i=e(this).attr("id");if(typeof cbHideFields!="undefined"){var a=[];e.each(cbHideFields,function(e,i){if(i[0]==t||i[1]==t){a.push(i)}});e.each(a,function(t,i){var r=[];r[0]=i[0].replace(n,s).replace(n.replace(/_{2,}/g,"__"),s.replace(/_{2,}/g,"__"));r[1]=i[1].replace(n,s).replace(n.replace(/_{2,}/g,"__"),s.replace(/_{2,}/g,"__"));r[2]=i[2];r[3]=i[3];r[4]=[];e.each(i[4],function(e,t){r[4].push(t.replace(n,s).replace(n.replace(/_{2,}/g,"__"),s.replace(/_{2,}/g,"__")))});r[5]=[];e.each(i[5],function(e,t){r[5].push(t.replace(n,s).replace(n.replace(/_{2,}/g,"__"),s.replace(/_{2,}/g,"__")))});var a=false;e.each(cbHideFields,function(e,t){if(t[0]==r[0]&&t[1]==r[1]&&t[2]==r[2]&&t[3]==r[3]){a=true}});if(!a){cbHideFields.push(r)}})}e(this).triggerHandler("modified",[t,i,r])})}if(e(this).attr("for")){var l=e(this).attr("for").replace(/__[a-zA-Z0-9]+$/g,"");if(!e(this).data("orgFor")){e(this).data("orgFor",e(this).attr("for"))}e(this).attr("for",e(this).attr("for").replace(/^(.*__)(\d+)(__\w+)$/g,"$1"+r+"$3"));var o=e(this).attr("for").replace(/__[a-zA-Z0-9]+$/g,"");var f=e(this).closest(".cbRepeatRow").find("*[for]");if(t.settings.ignore){f=f.not(t.settings.ignore)}f.each(function(){e(this).attr("for",e(this).attr("for").replace(l,o))})}if(e(this).attr("name")){var d=e(this).attr("name").replace(/\[[a-zA-Z0-9]+\]$/g,"");if(!e(this).data("orgName")){e(this).data("orgName",e(this).attr("name"))}e(this).attr("name",e(this).attr("name").replace(/^(.*)(\[\d+\])(\[\w+\])$/g,"$1["+r+"]$3"));var p=e(this).attr("name").replace(/\[[a-zA-Z0-9]+\]$/g,"");var h=e(this).closest(".cbRepeatRow").find("*[name]");if(t.settings.ignore){h=h.not(t.settings.ignore)}h.each(function(){e(this).attr("name",e(this).attr("name").replace(d,p))})}})});if(typeof cbHideFields!="undefined"){var r=[];e.each(cbHideFields,function(t,i){if(!e("#"+i[0]).length){r.push(i)}});e.each(r,function(e,t){cbHideFields.splice(cbHideFields.indexOf(t),1)})}if(typeof cbInitFields!="undefined"){cbInitFields()}if(i.length==t.settings.min){t.element.addClass("cbRepeatMin")}else if(i.length==t.settings.max){t.element.addClass("cbRepeatMax")}else{t.element.removeClass("cbRepeatMin cbRepeatMax")}t.element.triggerHandler("cbrepeat.updated",[t])}e.fn.cbrepeat=function(e){if(i[e]){return i[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return i.init.apply(this,arguments)}return this};e.fn.cbrepeat.defaults={init:true,useData:true,sortable:true,ignore:null,add:true,remove:true,min:1,max:0,limit:25}})(jQuery);